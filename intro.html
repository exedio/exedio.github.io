<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>exedio persistence - Introduction Trail</title>
		<meta name="keywords" content="Persistence, Java">
		<meta name="description" content="persistence framework for java">
		<link rel="stylesheet" href="cope.css">
	</head>
	<body>
<!-- HEADER -->
<div id="header_wrap" class="outer">
	<header class="inner">
		<a id="forkme_banner" href="https://github.com/exedio">View on GitHub</a>
		<h1 id="project_title">exedio persistence</h1>
		<h2 id="project_tagline">Persistence Framework for Java.</h2>
		<a id="toplink" href="index.html">Go to top</a>
	</header>
</div>
<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
	<section id="main_content" class="inner">

		<h2>Introduction Trail</h2>
		<p>
			This is the initial trail of the documentation trails.
			It gives you a step-by-step introduction into the persistence framework.
		</p>
		<p>
			If you already decided to use exedio persistence for a project,
			you may want to use the demoshop as a template.
			This way you can skip most of the steps described here.
			The demoshop is available under the
			<a href="https://opensource.org/licenses/mit-license.php">The&nbsp;MIT&nbsp;License</a>.
			<br>
			<a href="http://sourceforge.net/project/showfiles.php?group_id=152867">Download</a>
		</p>
		<h3><a name="contents">Contents</a></h3>
		<ul>
			<li><a href="#item">Your first item</a></li>
			<li><a href="#instrument">Setting up the instrumentor</a></li>
			<li><a href="#results">Results of the instrumentor</a></li>
			<li><a href="#run">Make it run</a></li>
			<li><a href="#further">Further Reading</a></li>
		</ul>
		<h3><a name="item">Your first item</a></h3>
		<p>
			Creating a new persistent class is
			as easy as creating any java class.
			Make sure, the class extends <a href="api/com/exedio/cope/Item.html">Item</a>:
		</p>
<pre>
class Customer extends <a href="api/com/exedio/cope/Item.html">Item</a>
{
}
</pre>
		<p>
			Now a persistent class isn't very useful
			without any persistent fields,
			so we also create our first one.
			To do this we declare a static final constant
			of the type <a href="api/com/exedio/cope/StringField.html">StringField</a>.
		</p>
<pre>
class Customer extends <a href="api/com/exedio/cope/Item.html">Item</a>
{
   static final <a href="api/com/exedio/cope/StringField.html">StringField</a> email = new <a href="api/com/exedio/cope/StringField.html#StringField--">StringField</a>();
}
</pre>
		<p>
			Thats the way you declare persistent classes and fields.
			Now we have to setup the source code instrumentor.
		</p>
		<h3><a name="instrument">Setting up the instrumentor</a></h3>
		<p>
			The instrumentor inserts a few methods and constructors into your
			source code, so you don't have to write it on your own.
			Don't worry, your code and the code generated by the instrumentor
			will peacefully coexist.
		</p>
		<p>
			Put a copy of
			<tt>exedio-cope.jar</tt>,
			<tt>exedio-cope-instrument.jar</tt>,
			<tt>trove.jar</tt> and
			<tt>bsh-core.jar</tt>
			into the directory where you keep your third-party libraries.
			In the following we assume, this is <tt>lib</tt>.
		</p>
		<p>
			Next we have to include the code instrumentor into your build process.
			Here we explain this for a build process managed by
			<a href="https://ant.apache.org/">apache ant</a>.
			We assume, that there is already a target <tt>compile</tt> which compiles
			your projects sources including class <tt>Customer</tt> created above
			located in directory <tt>src</tt>.
			Put the following into your <tt>build.xml</tt>
		</p>
<pre>
&lt;taskdef name="instrument"
         classname="com.exedio.cope.instrument.AntTask"&gt;
  &lt;classpath&gt;
    &lt;pathelement location="<i>lib/exedio-cope-instrument.jar</i>" /&gt;
  &lt;/classpath&gt;
&lt;/taskdef&gt;

&lt;target name="instrument"&gt;
  &lt;instrument verbose="false"&gt;
    &lt;fileset dir="<i>${basedir}/src</i>"&gt;
      &lt;include name="*.java" /&gt;
    &lt;/fileset&gt;
  &lt;/instrument&gt;
&lt;/target&gt;
</pre>
		<p>
			Parts in <tt><i>italics</i></tt> need to be adapted to your
			directory layout.
			Make target <tt>compile</tt> depend on target <tt>instrument</tt> and
			add <tt>lib/exedio-cope.jar</tt> to the classpath of the <tt>javac</tt> task.
		</p>
		<p>
			Now the instrumentor is ready to run.
			On the command line type <tt>ant instrument</tt>.
		</p>
		<h3><a name="results">Results of the instrumentor</a></h3>
		<p>
			After running the instrumentor,
			the class <tt>Customer</tt> contains a few more methods and constructors.
			Lets have a look, what these are useful for.
		</p>
		<p>
			The first one in the <i>default creation constructor</i>:
		</p>
<pre>
Customer(String email)
{
   this(new SetValue[]{Customer.email.map(email)});
}
</pre>
		<p>
			It creates a new customer and sets the initial value of the field
			<tt>email</tt> for that customer.
			Note, for brevity the code snippet above does not include
			javadoc comments generated by the instrumentor.
		</p>
		<p>
			Next one is the generic creation constructor:
		</p>
<pre>
Customer(SetValue[] setValues)
{
   super(setValue);
}
</pre>
		<p>
			It creates a new customer and sets the initial values for any set of fields
			for that customer.
			This comes handy if there are more fields in class Customer,
			since by default not all fields are set by the <i>default creation constructor</i>.
		</p>
		<p>
			Next one is the <i>reactivation constructor</i>:
		</p>
<pre>
Customer(ReactivationConstructorDummy d, int pk)
{
   super(d, pk);
}
</pre>
		<p>
			All you need to know about this for now is,
			that the framework uses this constructor internally and you don't have to care about.
			This constructor is one of the few things the framework has to demand for all persistent classes.
		</p>
		<p>
			Next are the <i>field getter</i>
			and <i>field setter</i> for the field <tt>email</tt>:
		</p>
<pre>
String getEmail()
{
   return email.get(this);
}

void setEmail(String email)
{
   Customer.email.set(this, email);
}
</pre>
		<p>
			These allow convenient read/write access to the values of the field,
			after the creation of the item.
		</p>
		<p>
			Last but not least there is the <i>type constant</i>:
		</p>
<pre>
static final Type&lt;Customer&gt; TYPE =
    newType(Customer.class);
</pre>
		<p>
			This is useful for all sorts of things,
			most prominently searching the database.
			For instance searching for all customers is as easy as
			<tt>Customer.TYPE.<a href="api/com/exedio/cope/Type.html#search--">search</a>()</tt>,
			which returns a <tt>List&lt;Customer&gt;</tt>.
			More on this in the <a href="searching.html">Searching Trail</a>.
		</p>
		<p>
			Next we will really store some persistent data.
		</p>
		<h3><a name="run">Make it run</a></h3>
		<p>
			First we have to tell the framework,
			which persistent types are to be maintained by the project.
			For now this will be type <tt>Customer</tt> only.
			So we write a new class <tt>Main</tt>:
		</p>
<pre>
class Main
{
   static final <a href="api/com/exedio/cope/Model.html">Model</a> model = new <a href="api/com/exedio/cope/Model.html#Model-com.exedio.cope.Type...-">Model</a>(
         Customer.TYPE
      );
}
</pre>
		<p>
			Of course, if you already have some central kind of main class,
			you can use this instead of writing a new one.
			Just make sure, that all your persistent types show up in the list.
		</p>
		<p>
			Next we will setup the database connection to be used by exedio persistence.
			First put a jdbc driver
			(i.e. <tt>hsqldb.jar</tt> or <tt>mysql-connector-bin-3.1.12.jar</tt>)
			in your classpath.
		</p>
		<p>
			Then create a file <tt>cope.properties</tt> with the following
			contents for hsqldb:
		</p>
<pre>
database.url=jdbc:hsqldb:mem:copetest
database.user=sa
database.password=
</pre>
		<p>
			or alternativly for mysql:
		</p>
<pre>
database.url=jdbc:mysql://<i>localhost</i>/<i>copetest</i>
database.user=<i>user</i>
database.password=<i>password</i>
</pre>
		<p>
			Parts in <tt><i>italics</i></tt> need to be adapted to your database.
			For mysql make sure, that the database does exist (<tt>create database copetest</tt>)
			and is accessible for the user.
		</p>
		<p>
			Finally we can add a main method to class <tt>Main</tt>,
			that creates a customer in the database.
		</p>
<pre>
public static void main(String[] args)
{
   model.<a href="api/com/exedio/cope/Model.html#connect-com.exedio.cope.ConnectProperties-">connect</a>(
      new <a href="api/com/exedio/cope/ConnectProperties.html#ConnectProperties-java.io.File-">ConnectProperties</a>(new File("cope.properties")));
   model.createDatabase();
   model.startTransaction();
   Customer c = new Customer("copetest@exedio.com");
   System.out.println("email:"+c.getEmail());
   c.setEmail("copetest@exedio.com");
   System.out.println("email2:"+c.getEmail());
   model.commit();
}
</pre>
		<p>
			The call to <tt>createDatabase</tt> builds the schema of the database.
			For this example it issues an sql statement like
			<tt>create table Customer ( email varchar(100) )</tt>
			to the database.
			Note, that for mysql the main method work once only.
			On any subsequent calls <tt>createDatabase</tt> fails,
			because table <tt>Customer</tt> already exists.
			On hsqldb the method work multiple times,
			because the database is in-memory only.
		</p>
		<h3><a name="further">Further Reading</a></h3>
		<p>
			This was the initial trail of the tour.
			You may now proceed to the following trails:
			<ul>
				<li>
					<a href="fields.html">Field Trail</a>
					tells you about fields beyond the string field covered by this trail.
				</li>
				<li>
					<a href="transactions.html">Transactions Trail</a>
					tells you all about that Model.startTransaction() mentioned above.
				</li>
				<li>
					<a href="webapplications.html">Web Application Trail</a>
					shows you the little differences when using exedio persistence within a web container.
				</li>
			</ul>
		</p>
	</section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
	<footer class="inner">
		<p>
			Maintained by
			<a href="https://www.exedio.com/" target="_top">exedio</a>
			Gesellschaft f&uuml;r Softwareentwicklung mbH.
		</p>
		<a href="https://validator.w3.org/check?uri=referer" class="validhtml">Valid HTML5</a>
		<p>
			Slate theme by <a href="https://github.com/jasoncostello">Jason Costello</a>.
			Published with <a href="https://pages.github.com">GitHub Pages</a>.
		</p>
	</footer>
</div>
	</body>
</html>
